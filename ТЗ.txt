–¢–ó: Telegram-–±–æ—Ç ¬´Brain Survivor¬ª (–≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ –Ω–∞ –≤—ã–±—ã–≤–∞–Ω–∏–µ)
## üéØ –°—É—Ç—å –∏–≥—Ä—ã
10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–≥—Ä–∞—é—Ç 10 —Ä–∞—É–Ω–¥–æ–≤ –ø–æ 10 –≤–æ–ø—Ä–æ—Å–æ–≤. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ä–∞—É–Ω–¥–∞ –≤—ã–±—ã–≤–∞–µ—Ç 1 –∏–≥—Ä–æ–∫ —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤. –ü—Ä–∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–µ –æ—á–∫–æ–≤ –≤—ã–±—ã–≤–∞–µ—Ç —Ç–æ—Ç, —É –∫–æ–≥–æ –±–æ–ª—å—à–µ —Å—É–º–º–∞—Ä–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ –æ—Ç–≤–µ—Ç—ã (–º–µ–¥–ª–µ–Ω–Ω–µ–µ). –§–∏–Ω–∞–ª: –±–∏—Ç–≤–∞ –¥–≤—É—Ö —Ñ–∏–Ω–∞–ª–∏—Å—Ç–æ–≤ –≤ 10 —Ä–∞—É–Ω–¥–∞—Ö.
---
## üéÆ –†–µ–∂–∏–º—ã –∏–≥—Ä—ã
-- 1. üèÉ –ë–´–°–¢–†–ê–Ø –ò–ì–†–ê (–æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∂–∏–º)
–ò–≥—Ä–æ–∫ –≤—Å—Ç–∞—ë—Ç –≤ –æ–±—â—É—é –æ—á–µ—Ä–µ–¥—å.
–ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—É–ª.
–ï—Å–ª–∏ 10+ —á–µ–ª–æ–≤–µ–∫ ‚Üí –∏–≥—Ä–∞ —Å—Ç–∞—Ä—Ç—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
–ï—Å–ª–∏ 3-9 —á–µ–ª–æ–≤–µ–∫ ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –Ω–∞ 45 —Å–µ–∫—É–Ω–¥:
`‚ñ∂Ô∏è –ù–ê–ß–ê–¢–¨ –°–ï–ô–ß–ê–°` (–¥–æ–±–∏—Ç—å –¥–æ 10 —É–º–Ω—ã–º–∏ –±–æ—Ç–∞–º–∏)
‚è≥ –ñ–î–ê–¢–¨ –ï–©–Å 5 –ú–ò–ù–£–¢
–ü—Ä–∞–≤–∏–ª–æ: –ï—Å–ª–∏ –í–°–ï –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ ¬´–ñ–î–ê–¢–¨¬ª ‚Üí –∂–¥—ë–º –µ—â—ë 5 –º–∏–Ω. –í –ª—é–±–æ–º –¥—Ä—É–≥–æ–º —Å–ª—É—á–∞–µ (—Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω ¬´–ù–ê–ß–ê–¢–¨¬ª –∏–ª–∏ –Ω–µ–æ—Ç–≤–µ—Ç) ‚Üí —Å—Ç–∞—Ä—Ç —Å –±–æ—Ç–∞–º–∏.
–ù–µ–æ—Ç–≤–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 45 —Å–µ–∫ = –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —Å—Ç–∞—Ä—Ç —Å –±–æ—Ç–∞–º–∏.
–ï—Å–ª–∏ 1-2 —á–µ–ª–æ–≤–µ–∫–∞ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º ¬´–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞¬ª.
-- 2. ü§ñ –¢–†–ï–ù–ò–†–û–í–ö–ê (–ø—Ä–æ—Ç–∏–≤ –±–æ—Ç–æ–≤)
–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç.
1 –∂–∏–≤–æ–π –∏–≥—Ä–æ–∫ + 9 –±–æ—Ç–æ–≤.
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–æ–≤: –ù–æ–≤–∏—á–æ–∫, –õ—é–±–∏—Ç–µ–ª—å, –≠–∫—Å–ø–µ—Ä—Ç.
-- 3. üë• –ü–†–ò–í–ê–¢–ù–ê–Ø –ò–ì–†–ê (—Å –¥—Ä—É–∑—å—è–º–∏)
–°–æ–∑–¥–∞—Ç–µ–ª—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç:
1.
–¢–µ–º—É.
2.
–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (2-10).
3.
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ—Ç–æ–≤ (–º–æ–∂–Ω–æ 0).
–ü—Ä–∏–º–µ—Ä: ¬´8 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –∏–∑ –Ω–∏—Ö 3 –±–æ—Ç–∞–º–∏¬ª ‚Üí –Ω—É–∂–Ω–æ 5 –¥—Ä—É–∑–µ–π.
–°—Ç–∞—Ä—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –≤—Å–µ—Ö —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –∂–∏–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤.
---
## ‚öôÔ∏è –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã
-- –í—ã–±—ã–≤–∞–Ω–∏–µ –ø—Ä–∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–µ –æ—á–∫–æ–≤
–§–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤—Ä–µ–º—è –æ—Ç –ø–æ–∫–∞–∑–∞ –≤–æ–ø—Ä–æ—Å–∞ –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞.
–ü—Ä–∏ —Ä–∞–≤–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –≤—ã–±—ã–≤–∞–µ—Ç –∏–≥—Ä–æ–∫ —Å –±–æ–ª—å—à–µ–π —Å—É–º–º–æ–π –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –≤ —Ä–∞—É–Ω–¥–µ.
-- –ë–æ—Ç—ã (—É–º–Ω—ã–µ)
–ó–∞–ø–æ–ª–Ω—è—é—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Å–ª–æ—Ç—ã.
–ù–µ –æ—Ç–ª–∏—á–∏–º—ã –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –æ—Ç –∂–∏–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã (—Ç–∞–π–Ω–æ –ø–æ–º–µ—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ).
–û—Ç–≤–µ—á–∞—é—Ç —Å —Ä–∞–Ω–¥–æ–º–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π 3-15 —Å–µ–∫—É–Ω–¥.
–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.
-- –ë–∞–∑–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
–ò—Å—Ç–æ—á–Ω–∏–∫–∏: –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –±–∞–∑ + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ò–ò (–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ) + –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–∫–ª–∞–¥ (—Å –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π).
–¢–µ–º—ã: –ö–∏–Ω–æ, –ù–∞—É–∫–∞, –°–ø–æ—Ä—Ç, –ú—É–∑—ã–∫–∞, –ì–µ–æ–≥—Ä–∞—Ñ–∏—è, –û–±—â–µ–µ –∏ –¥—Ä.
–í–∞–∂–Ω–æ: —Ç—ã—Å—è—á–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤.
---
## üì± –ü—Ä–æ—Ç–æ—Ç–∏–ø –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
üéÆ Brain Survivor
üèÉ
–ë–´–°–¢–†–ê–Ø –ò–ì–†–ê
‚Ä¢ –û—á–µ—Ä–µ–¥—å 5 –º–∏–Ω ‚Üí –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ ‚Üí —Å—Ç–∞—Ä—Ç
ü§ñ
–¢–†–ï–ù–ò–†–û–í–ö–ê
‚Ä¢ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø—Ä–æ—Ç–∏–≤ 9 –±–æ—Ç–æ–≤
üë•
–ü–†–ò–í–ê–¢–ù–ê–Ø –ò–ì–†–ê
‚Ä¢ –° –¥—Ä—É–∑—å—è–º–∏ + –≥–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–æ–≤
üìä
–†–ï–ô–¢–ò–ù–ì
üìñ
–ü–†–ê–í–ò–õ–ê
-- –•–æ–¥ —Ä–∞—É–Ω–¥–∞ (–ø—Ä–∏–º–µ—Ä –≤ –õ–°)
üèÅ –†–∞—É–Ω–¥ 3/10 | –¢–µ–º–∞: –ö–∏–Ω–æ
–í–æ–ø—Ä–æ—Å 7/10:
¬´–ö–∞–∫–æ–π –∞–∫—Ç–µ—Ä —Å—ã–≥—Ä–∞–ª –¢–æ–Ω–∏ –°—Ç–∞—Ä–∫–∞ –≤ MCU?¬ª
A) –ö—Ä–∏—Å –≠–≤–∞–Ω—Å
B) –†–æ–±–µ—Ä—Ç –î–∞—É–Ω–∏-–º–ª–∞–¥—à–∏–π
C) –ö—Ä–∏—Å –•–µ–º—Å–≤–æ—Ä—Ç
D) –ú–∞—Ä–∫ –†—É—Ñ—Ñ–∞–ª–æ
‚è±Ô∏è 20 —Å–µ–∫—É–Ω–¥
(–û—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ inline-–∫–Ω–æ–ø–∫–∏ –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–º)
-- –ò—Ç–æ–≥–∏ —Ä–∞—É–Ω–¥–∞ —Å –≤—ã–±—ã–≤–∞–Ω–∏–µ–º
üìä –ò–¢–û–ì–ò –†–ê–£–ù–î–ê 3/10
1. –ê–ª–µ–∫—Å–µ–π...... 9/10 (102.5—Å)
...
9. –î–º–∏—Ç—Ä–∏–π...... 2/10 (179.1—Å)
10. Bot_Gamma... 2/10 (185.6—Å)
‚ö†Ô∏è –†–∞–≤–µ–Ω—Å—Ç–≤–æ –æ—á–∫–æ–≤!
‚è±Ô∏è Bot_Gamma –æ—Ç–≤–µ—á–∞–ª –º–µ–¥–ª–µ–Ω–Ω–µ–µ.
üö´ –í—ã–±—ã–≤–∞–µ—Ç: Bot_Gamma
---
## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
1.
–°–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä–æ–∫–∞: –º–µ–Ω—é ‚Üí –≤ –ø—É–ª–µ ‚Üí –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ ‚Üí –≤ –∏–≥—Ä–µ ‚Üí –æ–∂–∏–¥–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ ‚Üí –≤—ã–±—ã–ª/–ø–æ–±–µ–¥–∏–ª.
2.
–¢–∞–π–º–µ—Ä—ã: –ö—Ä–∏—Ç–∏—á–Ω—ã. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (Celery, RabbitMQ).
3.
–ë–î –¥–ª—è –∏–≥—Ä—ã: game_id, theme, players: [user_id, score, total_time, is_bot], current_round, asked_questions.
4.
–û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è: Inline-–∫–Ω–æ–ø–∫–∏, callback_query, —Ñ–∏–∫—Å–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤, —Ç–∞–π–º–µ—Ä 45 —Å–µ–∫ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π.
5.
–ú–æ–¥—É–ª—å –±–æ—Ç–æ–≤: –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–æ–ø—Ä–æ—Å, –≤–∞—Ä–∏–∞–Ω—Ç—ã, —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –∏ –∑–∞–¥–µ—Ä–∂–∫—É.
–ù–∏–∂–µ ‚Äî –≤–∞—Ä–∏–∞–Ω—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î –ø–æ–¥ —Ç–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª. –û—Ä–∏–µ–Ω—Ç–∏—Ä: PostgreSQL, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ —Ñ–∞–Ω–∞—Ç–∏–∑–º–∞, —á—Ç–æ–±—ã —É–¥–æ–±–Ω–æ –±—ã–ª–æ –∏ –∏–≥—Ä–∞—Ç—å, –∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å.
---
## 1. –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- –í—Å–µ ID ‚Äî BIGSERIAL –∏–ª–∏ UUID (–Ω–∏–∂–µ –ø–∏—à—É BIGSERIAL –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã).
- –í—Ä–µ–º–µ–Ω–∞ –≤ UTC, TIMESTAMPTZ.
- –°—Ç–∞—Ç—É—Å—ã ‚Äî —á–µ—Ä–µ–∑ ENUM –∏–ª–∏ VARCHAR + –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ –∫–æ–¥–µ (—è —É–∫–∞–∂—É –≤–∞—Ä–∏–∞–Ω—Ç—ã).
- –ë–æ—Ç—ã –∏ –ª—é–¥–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ users, —É –±–æ—Ç–æ–≤ is_bot = true.
---
## 2. –¢–∞–±–ª–∏—Ü–∞ users
–•—Ä–∞–Ω–∏—Ç –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤, –≤ —Ç.—á. –±–æ—Ç–æ–≤.
CREATE TABLE users (
id
BIGSERIAL PRIMARY KEY,
telegram_id
BIGINT UNIQUE,
-- NULL –¥–ª—è –±–æ—Ç–æ–≤
username
VARCHAR(255),
full_name
VARCHAR(255),
is_bot
BOOLEAN NOT NULL DEFAULT FALSE,
bot_difficulty
VARCHAR(20),
-- NULL –¥–ª—è –∂–∏–≤—ã—Ö, 'novice'/'amateur'/'expert' –¥–ª—è –±–æ—Ç–æ–≤
rating
INTEGER NOT NULL DEFAULT 0,
games_played
INTEGER NOT NULL DEFAULT 0,
games_won
INTEGER NOT NULL DEFAULT 0,
created_at
TIMESTAMPTZ NOT NULL DEFAULT NOW(),
updated_at
TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
–ò–Ω–¥–µ–∫—Å—ã:
CREATE INDEX idx_users_telegram_id ON users (telegram_id);
CREATE INDEX idx_users_is_bot ON users (is_bot);
–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
- –ë–æ—Ç–æ–≤ –º–æ–∂–Ω–æ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏.
- bot_difficulty –º–æ–∂–Ω–æ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ users, –∞ –∑–∞–¥–∞–≤–∞—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –∏–≥—Ä—ã, –Ω–æ —É–¥–æ–±–Ω–æ –∏–º–µ—Ç—å –∏ —Ç—É—Ç
–¥–ª—è ‚Äú–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏‚Äù.
---
## 3. –¢–∞–±–ª–∏—Ü–∞ themes
–¢–µ–º—ã –≤–æ–ø—Ä–æ—Å–æ–≤ (–ö–∏–Ω–æ, –ù–∞—É–∫–∞ –∏ —Ç.–ø.).
CREATE TABLE themes (
id
BIGSERIAL PRIMARY KEY,
code
VARCHAR(50) UNIQUE NOT NULL,
-- 'movies', 'science'
name
VARCHAR(100) NOT NULL,
-- "–ö–∏–Ω–æ"
description TEXT
);
---
## 4. –¢–∞–±–ª–∏—Ü–∞ questions
–ë–∞–∑–∞ –≤–æ–ø—Ä–æ—Å–æ–≤.
CREATE TABLE questions (
id
BIGSERIAL PRIMARY KEY,
theme_id
BIGINT NOT NULL REFERENCES themes(id) ON DELETE RESTRICT,
question_text
TEXT NOT NULL,
option_a
TEXT NOT NULL,
option_b
TEXT NOT NULL,
option_c
TEXT,
option_d
TEXT,
correct_option
CHAR(1) NOT NULL,
-- 'A','B','C','D'
difficulty
VARCHAR(20),
-- 'easy', 'medium', 'hard' (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
source_type
VARCHAR(20) NOT NULL,
-- 'parsed', 'ai', 'user'
created_by
BIGINT REFERENCES users(id),-- NULL –¥–ª—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö/AI
is_approved
BOOLEAN NOT NULL DEFAULT TRUE, -- –º–æ–¥–µ—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö
created_at
TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
–ò–Ω–¥–µ–∫—Å—ã:
CREATE INDEX idx_questions_theme ON questions (theme_id);
CREATE INDEX idx_questions_theme_diff ON questions (theme_id, difficulty);
CREATE INDEX idx_questions_source ON questions (source_type);
---
## 5. –¢–∞–±–ª–∏—Ü–∞ user_questions_history (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤)
–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
CREATE TABLE user_questions_history (
user_id
BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
question_id BIGINT NOT NULL REFERENCES questions(id) ON DELETE CASCADE,
last_used_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
PRIMARY KEY (user_id, question_id)
);
---
## 6. –¢–∞–±–ª–∏—Ü–∞ games
–û–ø–∏—Å—ã–≤–∞–µ—Ç –æ–¥–Ω—É ‚Äú—Å–µ—Å—Å–∏—é‚Äù –∏–≥—Ä—ã (–±—ã—Å—Ç—Ä–∞—è, —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∏–ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω–∞—è).
CREATE TABLE games (
id
BIGSERIAL PRIMARY KEY,
game_type
VARCHAR(20) NOT NULL,
-- 'quick', 'training', 'private'
creator_id
BIGINT REFERENCES users(id),
theme_id
BIGINT REFERENCES themes(id),
-- NULL –µ—Å–ª–∏ "—Å–º–µ—à–∞–Ω–Ω—ã–µ —Ç–µ–º—ã"
status
VARCHAR(20) NOT NULL,
-- 'waiting', 'in_progress', 'finished', 'cancelled'
total_rounds
INTEGER NOT NULL DEFAULT 10, -- 10 —Ä–∞—É–Ω–¥–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
is_final_stage
BOOLEAN NOT NULL DEFAULT FALSE, -- —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –¥—É—ç–ª—å 1—Ö1
created_at
TIMESTAMPTZ NOT NULL DEFAULT NOW(),
started_at
TIMESTAMPTZ,
finished_at
TIMESTAMPTZ
);
–ò–Ω–¥–µ–∫—Å—ã:
CREATE INDEX idx_games_type_status ON games (game_type, status);
CREATE INDEX idx_games_status ON games (status);
–ù–∏–∂–µ ‚Äî –ø—É–Ω–∫—Ç—ã —Å 7 –ø–æ 14 –≤ –≤–∏–¥–µ –æ–¥–Ω–æ–≥–æ –∫–æ–ø–∏—Ä—É–µ–º–æ–≥–æ SQL-–±–ª–æ–∫–∞. –¢–∏–ø—ã —Å—Ç–∞—Ç—É—Å–æ–≤/—Ç–∏–ø–æ–≤ –∏–≥—Ä/–≥–æ–ª–æ—Å–æ–≤ (`VARCHAR`) –º–æ–∂–Ω–æ –ø–æ—Ç–æ–º –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ ENUM –ø–æ –≤–∫—É—Å—É.
```sql
-- 7. games ‚Äî –∏–≥—Ä—ã (—Å–µ—Å—Å–∏–∏)
CREATE TABLE games (
id
BIGSERIAL PRIMARY KEY,
game_type
VARCHAR(20) NOT NULL,
-- 'quick', 'training', 'private'
creator_id
BIGINT REFERENCES users(id),
theme_id
BIGINT REFERENCES themes(id),
-- NULL, –µ—Å–ª–∏ "—Å–º–µ—à–∞–Ω–Ω—ã–µ —Ç–µ–º—ã"
status
VARCHAR(20) NOT NULL,
-- 'waiting', 'pre_start', 'in_progress', 'finished', 'cancelled'
total_rounds
INTEGER NOT NULL DEFAULT 10,
is_final_stage
BOOLEAN NOT NULL DEFAULT FALSE,
current_round
INTEGER,
-- –º–æ–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥ –∑–¥–µ—Å—å
created_at
TIMESTAMPTZ NOT NULL DEFAULT NOW(),
started_at
TIMESTAMPTZ,
finished_at
TIMESTAMPTZ
);
CREATE INDEX idx_games_type_status ON games (game_type, status);
CREATE INDEX idx_games_status ON games (status);
-- 8. game_players ‚Äî —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∏–≥—Ä—ã –∏ –∏—Ö –∞–≥—Ä–µ–≥–∞—Ç—ã
CREATE TABLE game_players (
id
BIGSERIAL PRIMARY KEY,
game_id
BIGINT NOT NULL REFERENCES games(id) ON DELETE CASCADE,
user_id
BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
is_bot
BOOLEAN NOT NULL DEFAULT FALSE,
bot_difficulty
VARCHAR(20),
-- 'novice','amateur','expert' –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∏–≥—Ä—ã
join_order
INTEGER NOT NULL,
-- –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
total_score
INTEGER NOT NULL DEFAULT 0, -- –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∑–∞ –∏–≥—Ä—É
total_time
NUMERIC(10,3) NOT NULL DEFAULT 0, -- —Å—É–º–º–∞—Ä–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–æ–≤
is_eliminated
BOOLEAN NOT NULL DEFAULT FALSE,
eliminated_round INTEGER,
-- –Ω–æ–º–µ—Ä —Ä–∞—É–Ω–¥–∞, –≥–¥–µ –≤—ã–±—ã–ª
final_place
INTEGER,
-- –∏—Ç–æ–≥–æ–≤–æ–µ –º–µ—Å—Ç–æ (1..N)
created_at
TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
CREATE UNIQUE INDEX idx_game_players_unique
ON game_players (game_id, user_id);
CREATE INDEX idx_game_players_game
ON game_players (game_id);
-- 9. rounds ‚Äî —Ä–∞—É–Ω–¥—ã –≤ —Ä–∞–º–∫–∞—Ö –∏–≥—Ä—ã
CREATE TABLE rounds (
id
BIGSERIAL PRIMARY KEY,
game_id
BIGINT NOT NULL REFERENCES games(id) ON DELETE CASCADE,
round_number
INTEGER NOT NULL,
-- 1..10
theme_id
BIGINT REFERENCES themes(id), -- —Ç–µ–º–∞ —Ä–∞—É–Ω–¥–∞, –º–æ–∂–Ω–æ NULL
status
VARCHAR(20) NOT NULL,
-- 'not_started', 'in_progress', 'finished'
started_at
TIMESTAMPTZ,
finished_at
TIMESTAMPTZ
);
CREATE UNIQUE INDEX idx_rounds_game_round
ON rounds (game_id, round_number);
-- 10. round_questions ‚Äî –≤–æ–ø—Ä–æ—Å—ã –≤–Ω—É—Ç—Ä–∏ —Ä–∞—É–Ω–¥–∞
CREATE TABLE round_questions (
id
BIGSERIAL PRIMARY KEY,
round_id
BIGINT NOT NULL REFERENCES rounds(id) ON DELETE CASCADE,
question_id
BIGINT NOT NULL REFERENCES questions(id) ON DELETE RESTRICT,
question_number INTEGER NOT NULL,
-- 1..10
displayed_at
TIMESTAMPTZ,
-- –∫–æ–≥–¥–∞ –ø–æ–∫–∞–∑–∞–ª–∏ –≤–æ–ø—Ä–æ—Å
time_limit_sec
INTEGER NOT NULL DEFAULT 20
);
CREATE UNIQUE INDEX idx_round_questions_unique
ON round_questions (round_id, question_number);
CREATE INDEX idx_round_questions_round
ON round_questions (round_id);
-- 11. answers ‚Äî –æ—Ç–≤–µ—Ç—ã –∏–≥—Ä–æ–∫–æ–≤
CREATE TABLE answers (
id
BIGSERIAL PRIMARY KEY,
game_id
BIGINT NOT NULL REFERENCES games(id) ON DELETE CASCADE,
round_id
BIGINT NOT NULL REFERENCES rounds(id) ON DELETE CASCADE,
round_question_id
BIGINT NOT NULL REFERENCES round_questions(id) ON DELETE CASCADE,
user_id
BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
selected_option
CHAR(1),
-- 'A','B','C','D', NULL –µ—Å–ª–∏ –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª
is_correct
BOOLEAN,
answer_time
NUMERIC(10,3),
-- –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–æ—Ç displayed_at)
answered_at
TIMESTAMPTZ
);
CREATE UNIQUE INDEX idx_answers_unique
ON answers (round_question_id, user_id);
CREATE INDEX idx_answers_game_round_user
ON answers (game_id, round_id, user_id);
-- 12. pools ‚Äî –ø—É–ª—ã (–æ—á–µ—Ä–µ–¥–∏) –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∏–≥—Ä
CREATE TABLE pools (
id
BIGSERIAL PRIMARY KEY,
pool_type
VARCHAR(20) NOT NULL,
-- 'quick_public' –∏ —Ç.–ø.
status
VARCHAR(20) NOT NULL,
-- 'waiting', 'forming_game', 'closed'
created_at
TIMESTAMPTZ NOT NULL DEFAULT NOW(),
last_check_at
TIMESTAMPTZ
);
CREATE INDEX idx_pools_status
ON pools (status);
-- pool_players ‚Äî —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø—É–ª–∞
CREATE TABLE pool_players (
id
BIGSERIAL PRIMARY KEY,
pool_id
BIGINT NOT NULL REFERENCES pools(id) ON DELETE CASCADE,
user_id
BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
joined_at
TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
CREATE UNIQUE INDEX idx_pool_players_unique
ON pool_players (pool_id, user_id);
CREATE INDEX idx_pool_players_pool
ON pool_players (pool_id);
-- 13. game_votes ‚Äî –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ "–ù–ê–ß–ê–¢–¨ –°–ï–ô–ß–ê–° / –ñ–î–ê–¢–¨"
CREATE TABLE game_votes (
id
BIGSERIAL PRIMARY KEY,
game_id
BIGINT NOT NULL REFERENCES games(id) ON DELETE CASCADE,
user_id
BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
vote
VARCHAR(20) NOT NULL,
-- 'start_now', 'wait_more'
created_at
TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
CREATE UNIQUE INDEX idx_game_votes_unique
ON game_votes (game_id, user_id);
CREATE INDEX idx_game_votes_game
ON game_votes (game_id);
-- 14. game_used_questions ‚Äî –∫–∞–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤ –∏–≥—Ä–µ
CREATE TABLE game_used_questions (
game_id
BIGINT NOT NULL REFERENCES games(id) ON DELETE CASCADE,
question_id BIGINT NOT NULL REFERENCES questions(id) ON DELETE CASCADE,
PRIMARY KEY (game_id, question_id)
);
```
–∞–ª–≥–æ—Ä–∏—Ç–º –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ –ø—É–ª–∞ (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è).
–ê–ª–≥–æ—Ä–∏—Ç–º –ª—É—á—à–µ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –¥–≤–µ —á–∞—Å—Ç–∏:
1) –¥–∏—Å–ø–µ—Ç—á–µ—Ä –ø—É–ª–∞ (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç);
2) –¥–∏—Å–ø–µ—Ç—á–µ—Ä –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è (45 —Å–µ–∫—É–Ω–¥).
–ù–∏–∂–µ ‚Äî –ª–æ–≥–∏–∫–∞ —Ç–∞–∫, –∫–∞–∫ –µ—ë –º–æ–∂–Ω–æ –ø—Ä—è–º–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –≤ –∫–æ–¥ (Celery-–∑–∞–¥–∞—á–∏ / cron + —Ñ—É–Ω–∫—Ü–∏–∏).
---
## 1. –î–∏—Å–ø–µ—Ç—á–µ—Ä –ø—É–ª–∞ (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
–í—Ö–æ–¥: –Ω–∏–∫–∞–∫–æ–π, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏.
–¶–µ–ª—å: –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π –ø—É–ª ¬´–±—ã—Å—Ç—Ä–æ–π –∏–≥—Ä—ã¬ª, —Ä–µ—à–∏—Ç—å, —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ª—é–¥–µ–π.
-- 1.1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
1. –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ã–π –ø—É–ª –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∏–≥—Ä:
pool = SELECT * FROM pools
WHERE pool_type = 'quick_public'
AND status = 'waiting'
ORDER BY created_at ASC
LIMIT 1
2. –ï—Å–ª–∏ pool == null ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º, –≤—ã—Ö–æ–¥–∏–º.
3. –û–±–Ω–æ–≤–∏—Ç—å last_check_at:
UPDATE pools SET last_check_at = now()
WHERE id = pool.id
4. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤:
players = SELECT user_id FROM pool_players
WHERE pool_id = pool.id
ORDER BY joined_at ASC
5. N = players.count.
---
-- 1.2. –í–µ—Ç–∫–∞ A: N == 0
- –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º, –ø—Ä–æ—Å—Ç–æ –∂–¥—ë–º —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫.
---
-- 1.3. –í–µ—Ç–∫–∞ B: N == 1 –∏–ª–∏ N == 2
- –≠—Ç–∏–º –ª—é–¥—è–º –Ω—É–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ä–µ–∂–∏–º ‚Äú–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞‚Äù (1 –∂–∏–≤–æ–π + –±–æ—Ç—ã).
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram:
for user in players:
send_message(user,
"–°–µ–π—á–∞—Å –º–∞–ª–æ –ª—é–¥–µ–π –≤ –æ—á–µ—Ä–µ–¥–∏. –•–æ—á–µ—à—å —Å—ã–≥—Ä–∞—Ç—å –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–º —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Ç–∏–≤ –±–æ—Ç–æ–≤?")
show_buttons(["–î–∞, —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞", "–ü–æ–¥–æ–∂–¥–∞—Ç—å –µ—â—ë"])
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ—Ç–≤–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É–∂–µ –≤ —Ö—ç–Ω–¥–ª–µ—Ä–µ –±–æ—Ç–∞.
- –ü—É–ª –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º, —Å—Ç–∞—Ç—É—Å waiting –æ—Å—Ç–∞—ë—Ç—Å—è.
- –í–∞–∂–Ω–æ: –¥–∏—Å–ø–µ—Ç—á–µ—Ä –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç –∏–≥—Ä –ø—Ä–∏ 1‚Äì2 –ª—é–¥—è—Ö, —Ç–æ–ª—å–∫–æ —à–ª—ë—Ç –∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
---
-- 1.4. –í–µ—Ç–∫–∞ C: N >= 10 ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç
–ó–∞–¥–∞—á–∞: —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä—É –Ω–∞ 10 –∂–∏–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ (–±–µ–∑ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è) –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å.
1. –í–∑—è—Ç—å –ø–µ—Ä–≤—ã–µ 10 —á–µ–ª–æ–≤–µ–∫ (FIFO):
selected_players = players[0:10]
2. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –∏–≥—Ä—ã:
game_id = INSERT INTO games (
game_type, status, total_rounds, is_final_stage, created_at
) VALUES (
'quick', 'in_progress', 10, FALSE, now()
) RETURNING id;
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ —Å–æ–∑–¥–∞—Ç—å game_players:
join_order = 1
for user_id in selected_players:
INSERT INTO game_players (
game_id, user_id, is_bot, join_order, created_at
) VALUES (
game_id, user_id, FALSE, join_order, now()
)
join_order += 1
4. –£–¥–∞–ª–∏—Ç—å —ç—Ç–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ –ø—É–ª–∞:
DELETE FROM pool_players
WHERE pool_id = pool.id AND user_id IN (selected_players)
5. –ï—Å–ª–∏ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è pool —Å—Ç–∞–ª –ø—É—Å—Ç—ã–º:
remaining = SELECT COUNT(*) FROM pool_players WHERE pool_id = pool.id
if remaining == 0:
UPDATE pools SET status = 'closed' WHERE id = pool.id
6. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã (—Å–æ–∑–¥–∞–Ω–∏–µ rounds, round_questions, —Ä–∞—Å—Å—ã–ª–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –∏ —Ç.–ø.) ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞:
enqueue_task(start_game, game_id)
7. –û—Å—Ç–∞–≤—à–∏—Ö—Å—è –≤ –ø—É–ª–µ (–µ—Å–ª–∏ N > 10) –Ω–µ —Ç—Ä–æ–≥–∞–µ–º ‚Äî –æ–Ω–∏ –∂–¥—É—Ç —Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏.
---
-- 1.5. –í–µ—Ç–∫–∞ D: 3 <= N <= 9 ‚Äî –∑–∞–ø—É—Å–∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
–ó–∞–¥–∞—á–∞: –≤–∑—è—Ç—å —Ç–µ–∫—É—â–∏—Ö –ª—é–¥–µ–π, —Å–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É –≤ —Å—Ç–∞—Ç—É—Å–µ –æ–∂–∏–¥–∞–Ω–∏—è –∏ –∑–∞ 45 —Å–µ–∫ —Ä–µ—à–∏—Ç—å, —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å –∏–ª–∏ –∂–¥–∞—Ç—å.
1. –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º waiting/pre_start:
game_id = INSERT INTO games (
game_type, status, total_rounds, is_final_stage, created_at
) VALUES (
'quick', 'pre_start', 10, FALSE, now()
) RETURNING id;
2. –ü—Ä–∏–≤—è–∑–∞—Ç—å –≤—Å–µ—Ö –ª—é–¥–µ–π –∏–∑ –ø—É–ª–∞ –≤ game_players:
join_order = 1
for user_id in players:
-- –≤—Å–µ N —á–µ–ª–æ–≤–µ–∫
INSERT INTO game_players (
game_id, user_id, is_bot, join_order, created_at
) VALUES (
game_id, user_id, FALSE, join_order, now()
)
join_order += 1
3. –£–¥–∞–ª–∏—Ç—å —ç—Ç–∏—Ö –ª—é–¥–µ–π –∏–∑ –ø—É–ª–∞ (–æ–Ω–∏ ‚Äú–ø–µ—Ä–µ—à–ª–∏‚Äù –≤ –∏–≥—Ä—É):
DELETE FROM pool_players
WHERE pool_id = pool.id AND user_id IN (players)
4. –ï—Å–ª–∏ –ø—É–ª –æ–ø—É—Å—Ç–µ–ª ‚Äî –∑–∞–∫—Ä—ã—Ç—å:
remaining = SELECT COUNT(*) FROM pool_players WHERE pool_id = pool.id
if remaining == 0:
UPDATE pools SET status = 'closed' WHERE id = pool.id
5. –î–ª—è –∏–≥—Ä—ã —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ 45 —Å–µ–∫—É–Ω–¥:
enqueue_delayed_task(process_game_vote, game_id, delay=45s)
6. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:
```pseudo
for user_id in players:
send_message(
user_id,
"–ò–≥—Ä–æ–∫–æ–≤ —Å–µ–π—á–∞—Å: " + N + ". –ù–∞—á–∞—Ç—å –∏–≥—Ä—É —Å –±–æ—Ç–∞–º–∏ –∏–ª–∏ –ø–æ–¥–æ–∂–¥–∞—Ç—å –µ—â—ë 5 –º–∏–Ω—É—Ç?",
inline_buttons = [
("‚ñ∂Ô∏è –ù–ê–ß–ê–¢–¨ –°–ï–ô–ß–ê–°", callback_data="vote:start_now:" + game_id),
("‚è≥ –ñ–î–ê–¢–¨ –ï–©–Å 5 –ú–ò–ù–£–¢", callback_data="vote:wait_more:" + game_id)
]
)
```
7. –•—ç–Ω–¥–ª–µ—Ä callback‚Äô–æ–≤ –Ω–∞ –∫–Ω–æ–ø–∫–∏:
```pseudo
on_callback_vote(user_id, game_id, vote):
-- vote = 'start_now' –∏–ª–∏ 'wait_more'
-- –µ—Å–ª–∏ –∏–≥—Ä–∞ —É–∂–µ —É—à–ª–∞ –≤ –¥—Ä—É–≥–æ–π —Å—Ç–∞—Ç—É—Å, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
game = SELECT status FROM games WHERE id = game_id
if game.status != 'pre_start':
return
-- –∑–∞–ø–∏—Å–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –≥–æ–ª–æ—Å
INSERT INTO game_votes (game_id, user_id, vote, created_at)
VALUES (game_id, user_id, vote, now())
ON CONFLICT (game_id, user_id) DO UPDATE
SET vote = EXCLUDED.vote, created_at = EXCLUDED.created_at;
```
---
## 2. –î–∏—Å–ø–µ—Ç—á–µ—Ä –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è (—á–µ—Ä–µ–∑ 45 —Å–µ–∫—É–Ω–¥)
–ó–∞–¥–∞—á–∞ `process_game_vote(game_id)` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è Celery‚Äô—é / delayed job —Å–ø—É—Å—Ç—è 45 —Å–µ–∫ –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è.
*--* 2.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
```pseudo
game = SELECT * FROM games WHERE id = game_id FOR UPDATE;
if game.status != 'pre_start':
-- –∏–≥—Ä–∞ —É–∂–µ –∫–µ–º-—Ç–æ –∑–∞–ø—É—â–µ–Ω–∞/–æ—Ç–º–µ–Ω–µ–Ω–∞
return
```
(–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞—Ç—å `FOR UPDATE`, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –≥–æ–Ω–æ–∫).
*--* 2.2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ –∏ –≥–æ–ª–æ—Å–æ–≤
```pseudo
players = SELECT user_id FROM game_players
WHERE game_id = game_id AND is_bot = FALSE;
votes = SELECT user_id, vote FROM game_votes
WHERE game_id = game_id;
```
- `N_players = players.count`.
- –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞–ø—É `vote_by_user`:
```pseudo
vote_by_user = { v.user_id: v.vote for v in votes }
```
–ò–≥—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ `vote_by_user` ‚Äî —Å—á–∏—Ç–∞—é—Ç—Å—è *—Å–æ–≥–ª–∞—Å–Ω—ã–º–∏ –Ω–∞—á–∞—Ç—å —Å–µ–π—á–∞—Å* (–ø–æ –¢–ó: –Ω–µ–æ—Ç–≤–µ—Ç = —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —Å—Ç–∞—Ä—Ç).
*--* 2.3. –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è
–ü–æ –ø—Ä–∞–≤–∏–ª–∞–º:
> –ï—Å–ª–∏ –í–°–ï –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ ¬´–ñ–î–ê–¢–¨¬ª ‚Üí –∂–¥—ë–º –µ—â—ë 5 –º–∏–Ω.
> –í –ª—é–±–æ–º –¥—Ä—É–≥–æ–º —Å–ª—É—á–∞–µ (—Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω ¬´–ù–ê–ß–ê–¢–¨¬ª –∏–ª–∏ –Ω–µ–æ—Ç–≤–µ—Ç) ‚Üí —Å—Ç–∞—Ä—Ç —Å –±–æ—Ç–∞–º–∏.
1. –ü—Ä–æ–≤–µ—Ä–∏–º, –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—å –æ–¥–∏–Ω `start_now` –∏–ª–∏ –Ω–µ–æ—Ç–≤–µ—Ç:
```pseudo
all_wait = true
for user_id in players:
v = vote_by_user.get(user_id)
if v is NULL:
-- –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª ‚Üí —Ç—Ä–∞–∫—Ç—É–µ–º –∫–∞–∫ —Å–æ–≥–ª–∞—Å–∏–µ "–ù–ê–ß–ê–¢–¨"
all_wait = false
break
if v == 'start_now':
all_wait = false
break
```
2. –ï—Å–ª–∏ `all_wait == true` ‚Üí *–≤–µ—Ç–∫–∞ ‚Äú–ñ–î–ê–¢–¨ –ï–©–Å 5 –ú–ò–ù–£–¢‚Äù*.
–ò–Ω–∞—á–µ ‚Üí *–≤–µ—Ç–∫–∞ ‚Äú–°–¢–ê–†–¢–û–í–ê–¢–¨ –° –ë–û–¢–ê–ú–ò‚Äù*.
---
*--* 2.4. –í–µ—Ç–∫–∞ 1: –≤—Å–µ –≤—ã–±—Ä–∞–ª–∏ ¬´–ñ–î–ê–¢–¨ –ï–©–ï 5 –ú–ò–ù–£–¢¬ª
–ó–∞–¥–∞—á–∞: –≤–µ—Ä–Ω—É—Ç—å –∏–≥—Ä–æ–∫–æ–≤ –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—É–ª, –∏–≥—Ä–∞ `game` ‚Äî –æ—Ç–º–µ–Ω–µ–Ω–∞/–∑–∞–º–æ—Ä–æ–∂–µ–Ω–∞.
1. –í–µ—Ä–Ω—É—Ç—å –∏–≥—Ä–æ–∫–æ–≤ –≤ –ø—É–ª (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –≤ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ª–∏–±–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π):
```pseudo
pool = SELECT * FROM pools
WHERE pool_type = 'quick_public'
AND status = 'waiting'
ORDER BY created_at ASC
LIMIT 1
if pool == null:
pool_id = INSERT INTO pools (pool_type, status, created_at)
VALUES ('quick_public', 'waiting', now())
RETURNING id
else:
pool_id = pool.id
```
2. –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤ –≤ `pool_players`:
```pseudo
for user_id in players:
INSERT INTO pool_players (pool_id, user_id, joined_at)
VALUES (pool_id, user_id, now())
ON CONFLICT (pool_id, user_id) DO NOTHING; -- –Ω–∞ —Å–ª—É—á–∞–π –¥—É–±–ª–µ–π
```
3. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏–≥—Ä—ã:
```pseudo
UPDATE games
SET status = 'cancelled'
WHERE id = game_id;
```
4. (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –û–ø–æ–≤–µ—Å—Ç–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤:
```pseudo
for user_id in players:
send_message(
user_id,
"–í—Å–µ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ –∑–∞ –æ–∂–∏–¥–∞–Ω–∏–µ. –ñ–¥—ë–º –µ—â—ë 5 –º–∏–Ω—É—Ç, —Ç—ã –æ—Å—Ç–∞—ë—à—å—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ –±—ã—Å—Ç—Ä—É—é –∏–≥—Ä—É."
)
```
5. –ù–∞ —Å–ª–µ–¥—É—é—â–µ–º 5-–º–∏–Ω—É—Ç–Ω–æ–º —Ç–∏–∫–µ –¥–∏—Å–ø–µ—Ç—á–µ—Ä –ø—É–ª–∞ —Å–Ω–æ–≤–∞ —É–≤–∏–¥–∏—Ç –ø—É–ª —Å —ç—Ç–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç –ª–æ–≥–∏–∫—É.
---
*--* 2.5. –í–µ—Ç–∫–∞ 2: —Å—Ç–∞—Ä—Ç —Å –±–æ—Ç–∞–º–∏
–ó–∞–¥–∞—á–∞: –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∏–≥—Ä—É –±–æ—Ç–∞–º–∏ –¥–æ 10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å.
1. –ü–æ—Å—á–∏—Ç–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –±–æ—Ç–æ–≤ –Ω—É–∂–Ω–æ:
```pseudo
N_live = players.count
N_total = 10
N_bots_needed = N_total - N_live
if N_bots_needed < 0:
N_bots_needed = 0
```
2. –í—ã–±—Ä–∞—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –±–æ—Ç–æ–≤ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏). –ü—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –∏–º–µ—Ç—å –∑–∞—Ä–∞–Ω–µ–µ –Ω–∞–±–æ—Ä `users` —Å `is_bot = true`:
```pseudo
bots = SELECT id, bot_difficulty FROM users
WHERE is_bot = true
LIMIT N_bots_needed
```
3. –î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–æ–≤ –≤ `game_players`:
```pseudo
current_max_join_order = SELECT COALESCE(MAX(join_order), 0)
FROM game_players
WHERE game_id = game_id
join_order = current_max_join_order + 1
for bot in bots:
INSERT INTO game_players (
game_id, user_id, is_bot, bot_difficulty, join_order, created_at
) VALUES (
game_id, bot.id, TRUE, bot.bot_difficulty, join_order, now()
)
join_order += 1
```
4. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏–≥—Ä—ã –Ω–∞ `in_progress` –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å `started_at`:
```pseudo
UPDATE games
SET status = 'in_progress',
started_at = now()
WHERE id = game_id;
```
5. –û–ø–æ–≤–µ—Å—Ç–∏—Ç—å –∂–∏–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤:
```pseudo
for user_id in players:
send_message(
user_id,
"–ò–≥—Ä–∞ —Å—Ç–∞—Ä—Ç—É–µ—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å! –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –º–µ—Å—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –±–æ—Ç–∞–º–∏."
)
```
6. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä–æ–≤—É—é –ª–æ–≥–∏–∫—É (—Å–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞, –≤—ã–±–æ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ —Ç.–¥.):
```pseudo
enqueue_task(start_game, game_id)
```
---
## 3. –í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
*--* 3.1. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏/–∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è
- –í `process_game_vote(game_id)` –¥–µ–ª–∞–π `SELECT ... FOR UPDATE` –ø–æ `games`,
—á—Ç–æ–±—ã –¥–≤–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Ç–∞—Å–∫–∞ (–∏–ª–∏ –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –≤ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–µ–∫—É–Ω–¥—É) –Ω–µ —Å–ª–æ–º–∞–ª–∏ —Å—Ç–∞—Ç—É—Å.
- –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø—É–ª–æ–º –º–æ–∂–Ω–æ:
- –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `FOR UPDATE` –Ω–∞ `pools` –ø—Ä–∏ –≤—ã–±–æ—Ä–∫–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—É–ª–∞;
- –ª–∏–±–æ –∏–º–µ—Ç—å ‚Äú–º–∞—Å—Ç–µ—Ä-–∑–∞–¥–∞—á—É‚Äù (–æ–¥–Ω–∞ Celery-–æ—á–µ—Ä–µ–¥—å), —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ –ø—É–ª–∞.
*--* 3.2. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –∑–∞–¥–∞—á
- –ü—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏: –µ—Å–ª–∏ —Ç–∞—Å–∫ –≤–Ω–µ–∑–∞–ø–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏–ª—Å—è, –æ–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –∏–≥—Ä/–ø—É–ª–æ–≤.
- –ü—Ä–∏–º–µ—Ä—ã –∑–∞—â–∏—Ç—ã:
- –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏–≥—Ä—ã –µ—â—ë —Ä–∞–∑ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –Ω–µ—Ç –ª–∏ —É–∂–µ `games` –≤ —Å—Ç–∞—Ç—É—Å–µ `pre_start/in_progress` –¥–ª—è —ç—Ç–∏—Ö –∏–≥—Ä–æ–∫–æ–≤;
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã `forming_game`, —á—Ç–æ–±—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –ø—É–ª —É–∂–µ ‚Äú–≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ‚Äù.
*--* 3.3. –ì–¥–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—É–ª
- –ú–æ–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å *–æ–¥–∏–Ω —Ç–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π –ø—É–ª* `quick_public`:
- –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ ‚Äú–ë—ã—Å—Ç—Ä–∞—è –∏–≥—Ä–∞‚Äù:
- –∏—â–µ—à—å –∞–∫—Ç–∏–≤–Ω—ã–π –ø—É–ª `waiting`;
- –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë—à—å –Ω–æ–≤—ã–π;
- –¥–æ–±–∞–≤–ª—è–µ—à—å –∏–≥—Ä–æ–∫–∞ –≤ `pool_players`.
- –î–∏—Å–ø–µ—Ç—á–µ—Ä –ø—É–ª–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å *–æ–¥–Ω–∏–º* –∞–∫—Ç–∏–≤–Ω—ã–º –ø—É–ª–æ–º.
ChatGPT & DeepSeek ‚ô•Ô∏è, [17.01.2026 14:34]
–î–ª—è —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ —Ñ–æ—Ä–º–∞—Ç –ª—É—á—à–µ —Å—Ä–∞–∑—É –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–∫–æ–π, —á—Ç–æ–±—ã:
1) —É–¥–æ–±–Ω–æ –±—ã–ª–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î,
2) –ª–µ–≥–∫–æ –±—ã–ª–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –ò–ò,
3) –ø–æ–Ω—è—Ç–Ω–æ –±—ã–ª–æ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º/—Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º.
–ù–∏–∂–µ ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: JSON-–æ–±—ä–µ–∫—Ç –≤–æ–ø—Ä–æ—Å–∞ + –µ–≥–æ –º–∞–ø–ø–∏–Ω–≥ –≤ —Ç–≤–æ—é —Ç–∞–±–ª–∏—Ü—É questions.
---
## 1. –§–æ—Ä–º–∞—Ç –≤–æ–ø—Ä–æ—Å–∞ (–ª–æ–≥–∏—á–µ—Å–∫–∏–π, –≤ –∫–æ–¥–µ / –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)
–û–¥–∏–Ω –≤–æ–ø—Ä–æ—Å:
{
"theme": "–ö–∏–Ω–æ",
"difficulty": "medium",
"question_text": "–ö–∞–∫–æ–π –∞–∫—Ç—ë—Ä —Å—ã–≥—Ä–∞–ª –¢–æ–Ω–∏ –°—Ç–∞—Ä–∫–∞ –≤ –∫–∏–Ω–æ–≤—Å–µ–ª–µ–Ω–Ω–æ–π Marvel?",
"options": [
"–ö—Ä–∏—Å –≠–≤–∞–Ω—Å",
"–†–æ–±–µ—Ä—Ç –î–∞—É–Ω–∏-–º–ª–∞–¥—à–∏–π",
"–ö—Ä–∏—Å –•–µ–º—Å–≤–æ—Ä—Ç",
"–ú–∞—Ä–∫ –†—É—Ñ—Ñ–∞–ª–æ"
],
"correct_index": 1,
"source_type": "ai"
}
–ü–æ—è—Å–Ω–µ–Ω–∏—è:
- theme ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –∫–æ–¥ —Ç–µ–º—ã ("movies", "–ù–∞—É–∫–∞", –∏ —Ç.–¥.).
- difficulty ‚Äî "easy" | "medium" | "hard" (–ø–æ –∂–µ–ª–∞–Ω–∏—é, –º–æ–∂–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å).
- question_text ‚Äî —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞.
- options ‚Äî –º–∞—Å—Å–∏–≤ —Ä–æ–≤–Ω–æ –∏–∑ 4 —Å—Ç—Ä–æ–∫, –ø–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω (A, B, C, D).
- correct_index ‚Äî –∏–Ω–¥–µ–∫—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –≤ –º–∞—Å—Å–∏–≤–µ options (0‚Äì3).
- source_type ‚Äî "parsed" | "ai" | "user".
–¢–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç:
- —É–¥–æ–±–Ω–æ –æ—Ç–¥–∞–≤–∞—Ç—å/–ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏–∑ –ò–ò;
- –ª–µ–≥–∫–æ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –ë–î.
---
## 2. –ö–∞–∫ —ç—Ç–æ –ª–æ–∂–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É questions
–¢–≤–æ—è —Ç–∞–±–ª–∏—Ü–∞ (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è) —É–∂–µ –ø–æ–¥—Ö–æ–¥–∏—Ç:
CREATE TABLE questions (
id
BIGSERIAL PRIMARY KEY,
theme_id
BIGINT NOT NULL REFERENCES themes(id) ON DELETE RESTRICT,
question_text
TEXT NOT NULL,
option_a
TEXT NOT NULL,
option_b
TEXT NOT NULL,
option_c
TEXT NOT NULL,
option_d
TEXT NOT NULL,
correct_option
CHAR(1) NOT NULL,
-- 'A','B','C','D'
difficulty
VARCHAR(20),
-- 'easy', 'medium', 'hard'
source_type
VARCHAR(20) NOT NULL,
-- 'parsed', 'ai', 'user'
created_by
BIGINT REFERENCES users(id),
is_approved
BOOLEAN NOT NULL DEFAULT TRUE,
created_at
TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ JSON ‚Üí —Å—Ç—Ä–æ–∫–∞ –≤ –ë–î:
q = –≤–æ–ø—Ä–æ—Å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON (—Å–º. –≤—ã—à–µ)
theme_id = SELECT id FROM themes WHERE name = q.theme OR code = q.theme
INSERT INTO questions (
theme_id,
question_text,
option_a,
option_b,
option_c,
option_d,
correct_option,
difficulty,
source_type,
created_by,
is_approved
) VALUES (
theme_id,
q.question_text,
q.options[0],
q.options[1],
q.options[2],
q.options[3],
CASE q.correct_index
WHEN 0 THEN 'A'
WHEN 1 THEN 'B'
WHEN 2 THEN 'C'
WHEN 3 THEN 'D'
END,
q.difficulty,
q.source_type,
:created_by,
-- NULL –¥–ª—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö/–ò–ò, id –¥–ª—è —é–∑–µ—Ä—Å–∫–∏—Ö
:is_approved
-- TRUE –¥–ª—è —Å–≤–æ–∏—Ö/–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö, FALSE –¥–ª—è –Ω–æ–≤—ã—Ö —é–∑–µ—Ä—Å–∫–∏—Ö
);
---
## 3. –ö–∞–∫ –æ—Ç–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å –≤ –∏–≥—Ä—É
–ö–æ–≥–¥–∞ —Ç—ã –≤—ã–±–∏—Ä–∞–µ—à—å –≤–æ–ø—Ä–æ—Å –∏–∑ –ë–î –¥–ª—è —Ä–∞—É–Ω–¥–∞, —Ç—ã –º–æ–∂–µ—à—å –ø—Ä–∏–≤–µ—Å—Ç–∏ –µ–≥–æ –∫ —É–¥–æ–±–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É –¥–ª—è –±–æ—Ç–∞:
{
"question_id": 12345,
"theme": "–ö–∏–Ω–æ",
"difficulty": "medium",
"question_text": "–ö–∞–∫–æ–π –∞–∫—Ç—ë—Ä —Å—ã–≥—Ä–∞–ª –¢–æ–Ω–∏ –°—Ç–∞—Ä–∫–∞ –≤ –∫–∏–Ω–æ–≤—Å–µ–ª–µ–Ω–Ω–æ–π Marvel?",
"options": [
{ "label": "A", "text": "–ö—Ä–∏—Å –≠–≤–∞–Ω—Å" },
{ "label": "B", "text": "–†–æ–±–µ—Ä—Ç –î–∞—É–Ω–∏-–º–ª–∞–¥—à–∏–π" },
{ "label": "C", "text": "–ö—Ä–∏—Å –•–µ–º—Å–≤–æ—Ä—Ç" },
{ "label": "D", "text": "–ú–∞—Ä–∫ –†—É—Ñ—Ñ–∞–ª–æ" }
],
"correct_option": "B"
}
–ù–æ –≤–Ω—É—Ç—Ä–∏ –±–∞–∑—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –ª—É—á—à–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ, –∫–∞–∫ –≤—ã—à–µ: –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è option_a..d + correct_option.
---
## 4. –§–æ—Ä–º–∞—Ç –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ / –∏–º–ø–æ—Ä—Ç–∞ CSV
–ß—Ç–æ–±—ã —Ä—É–∫–∞–º–∏ –∑–∞–Ω–æ—Å–∏—Ç—å/–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CSV —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏:
- theme
- difficulty
- question_text
- option_a
- option_b
- option_c
- option_d
- correct_option (A/B/C/D)
- source_type
–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ CSV:
–ö–∏–Ω–æ,medium,"–ö–∞–∫–æ–π –∞–∫—Ç—ë—Ä —Å—ã–≥—Ä–∞–ª –¢–æ–Ω–∏ –°—Ç–∞—Ä–∫–∞ –≤ –∫–∏–Ω–æ–≤—Å–µ–ª–µ–Ω–Ω–æ–π Marvel?","–ö—Ä–∏—Å –≠–≤–∞–Ω—Å","–†–æ–±–µ—Ä—Ç –î–∞—É–Ω–∏-–º–ª–∞–¥—à–∏–π","–ö—Ä–∏—Å –•–µ–º—Å–≤–æ—Ä—Ç","–ú–∞—Ä–∫ –†—É—Ñ—Ñ–∞–ª–æ",B,parsed
–°–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∞:
- —á–∏—Ç–∞–µ—Ç CSV,
- –Ω–∞—Ö–æ–¥–∏—Ç/—Å–æ–∑–¥–∞—ë—Ç —Ç–µ–º—É,
- –º–∞–ø–∏—Ç –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É questions.
---
## 5. –§–æ—Ä–º–∞—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –ò–ò (–ø—Ä–æ–º–ø—Ç-–æ—Ä–∏–µ–Ω—Ç–∏—Ä)
–ö–æ–≥–¥–∞ —Ç—ã –ø—Ä–æ—Å–∏—à—å –ò–ò —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã, –¥–∞—ë—à—å —á—ë—Ç–∫–∏–π —Ñ–æ—Ä–º–∞—Ç:
–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π 20 –≤–∏–∫—Ç–æ—Ä–∏–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–µ–º–µ "–ö–∏–Ω–æ".
–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ ‚Äî JSON-–º–∞—Å—Å–∏–≤.
–ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç:
- theme: —Å—Ç—Ä–æ–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ö–∏–Ω–æ"),
- difficulty: "easy" | "medium" | "hard",
- questiontext: —Å—Ç—Ä–æ–∫–∞,
- options: –º–∞—Å—Å–∏–≤ —Ä–æ–≤–Ω–æ –∏–∑ 4 —Å—Ç—Ä–æ–∫ (–≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤),
- correctindex: —á–∏—Å–ª–æ 0, 1, 2 –∏–ª–∏ 3 (–∏–Ω–¥–µ–∫—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –≤ –º–∞—Å—Å–∏–≤–µ options).
–û—Ç–≤–µ—Ç ‚Äî —Ç–æ–ª—å–∫–æ JSON, –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
–¢–∞–∫ —Ç—ã —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ—à—å –Ω—É–∂–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∞ –¥–∞–ª—å—à–µ —Ç–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—à—å –≤ –ë–î.
---
–ò—Ç–æ–≥–æ: –¥–ª—è —Ç–≤–æ–µ–π –∏–≥—Ä—ã —Å—Ç–∞–Ω–¥–∞—Ä—Ç ‚Äî –≤–æ–ø—Ä–æ—Å = —Ç–µ–∫—Å—Ç + 4 –æ–ø—Ü–∏–∏ (A‚ÄìD) + —É–∫–∞–∑–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (correct_option –∏–ª–∏ correct_index). –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ (—Ç–µ–º–∞, —Å–ª–æ–∂–Ω–æ—Å—Ç—å, –∏—Å—Ç–æ—á–Ω–∏–∫) ‚Äî —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –æ—Ç–±–æ—Ä–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.
–ù—É–∂–Ω–æ –ø–æ–º–æ—á—å —Ç–µ–±–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–Ω—ã–π JSON-—Ñ–æ—Ä–º–∞—Ç –∏ SQL-—Å–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∞ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –≤–æ–ø—Ä–æ—Å–æ–≤?
