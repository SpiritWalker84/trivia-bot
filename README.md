# Trivia Bot - Brain Survivor

Telegram-–±–æ—Ç –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ –Ω–∞ –≤—ã–±—ã–≤–∞–Ω–∏–µ "Brain Survivor".

## –û–ø–∏—Å–∞–Ω–∏–µ

10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–≥—Ä–∞—é—Ç 10 —Ä–∞—É–Ω–¥–æ–≤ –ø–æ 10 –≤–æ–ø—Ä–æ—Å–æ–≤. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ä–∞—É–Ω–¥–∞ –≤—ã–±—ã–≤–∞–µ—Ç 1 –∏–≥—Ä–æ–∫ —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤. –ü—Ä–∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–µ –æ—á–∫–æ–≤ –≤—ã–±—ã–≤–∞–µ—Ç —Ç–æ—Ç, —É –∫–æ–≥–æ –±–æ–ª—å—à–µ —Å—É–º–º–∞—Ä–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ –æ—Ç–≤–µ—Ç—ã. –§–∏–Ω–∞–ª: –±–∏—Ç–≤–∞ –¥–≤—É—Ö —Ñ–∏–Ω–∞–ª–∏—Å—Ç–æ–≤.

## –†–µ–∂–∏–º—ã –∏–≥—Ä—ã

- üèÉ **–ë—ã—Å—Ç—Ä–∞—è –∏–≥—Ä–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–∞—Ç—á–º–µ–π–∫–∏–Ω–≥, –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ 3-9 –∏–≥—Ä–æ–∫–∞—Ö
- ü§ñ **–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞** - –∏–≥—Ä–∞ –ø—Ä–æ—Ç–∏–≤ –±–æ—Ç–æ–≤ (9 –±–æ—Ç–æ–≤)
- üë• **–ü—Ä–∏–≤–∞—Ç–Ω–∞—è –∏–≥—Ä–∞** - –∏–≥—Ä–∞ —Å –¥—Ä—É–∑—å—è–º–∏ (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
trivia-bot/
‚îú‚îÄ‚îÄ bot/                    # Telegram bot –º–æ–¥—É–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ handlers/          # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/         # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ inline-–∫–Ω–æ–ø–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ middleware/        # Middleware –¥–ª—è –±–æ—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ states.py          # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îú‚îÄ‚îÄ database/              # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ models.py          # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ queries.py         # –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ session.py         # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ migrations/        # –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic
‚îú‚îÄ‚îÄ game/                  # –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ engine.py          # –ò–≥—Ä–æ–≤–æ–π –¥–≤–∏–∂–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ elimination.py     # –õ–æ–≥–∏–∫–∞ –≤—ã–±—ã–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ rating.py          # –°–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞
‚îÇ   ‚îî‚îÄ‚îÄ bots.py            # –ò–ò –±–æ—Ç–æ–≤
‚îú‚îÄ‚îÄ tasks/                 # Celery –∑–∞–¥–∞—á–∏
‚îÇ   ‚îú‚îÄ‚îÄ celery_app.py      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Celery
‚îÇ   ‚îú‚îÄ‚îÄ pool_dispatcher.py # –î–∏—Å–ø–µ—Ç—á–µ—Ä –ø—É–ª–∞ (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω)
‚îÇ   ‚îú‚îÄ‚îÄ vote_dispatcher.py # –î–∏—Å–ø–µ—Ç—á–µ—Ä –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ game_tasks.py      # –ó–∞–¥–∞—á–∏ –∏–≥—Ä—ã
‚îú‚îÄ‚îÄ questions/             # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ manager.py         # –í—ã–±–æ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ sources/           # –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤
‚îú‚îÄ‚îÄ utils/                 # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ retry.py           # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã —Ä–µ—Ç—Ä–∞–µ–≤
‚îÇ   ‚îú‚îÄ‚îÄ errors.py          # –ò—Å–∫–ª—é—á–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ logging.py         # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ tests/                 # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ unit/              # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ integration/       # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ e2e/               # End-to-end —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ main.py                # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone <repository-url>
cd trivia-bot
```

2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate  # Windows
```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

4. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:
```bash
cp .env.example .env
```

5. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ `.env` —Ñ–∞–π–ª —Å–≤–æ–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:
- `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ Telegram –±–æ—Ç–∞
- `DATABASE_URL` - URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
- `REDIS_URL` - URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
- –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

6. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL:
```sql
CREATE DATABASE trivia_bot;
```

7. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î:
```python
from database.session import get_db_session
db = get_db_session()
db.create_tables()
```

## –ó–∞–ø—É—Å–∫

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞:
```bash
python main.py
```

### –ó–∞–ø—É—Å–∫ Celery worker:
```bash
celery -A tasks.celery_app worker --loglevel=info
```

### –ó–∞–ø—É—Å–∫ Celery beat (–¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á):
```bash
celery -A tasks.celery_app beat --loglevel=info
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:**
   ```bash
   python scripts/create_tables.py
   python scripts/add_test_data.py
   ```

2. **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤:**
   ```bash
   # –¢–µ—Ä–º–∏–Ω–∞–ª 1
   python main.py
   
   # –¢–µ—Ä–º–∏–Ω–∞–ª 2
   celery -A tasks.celery_app worker --loglevel=info
   
   # –¢–µ—Ä–º–∏–Ω–∞–ª 3
   celery -A tasks.celery_app beat --loglevel=info
   ```

3. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –∏–≥—Ä—ã:**
   ```bash
   python scripts/create_test_game.py --telegram-id YOUR_TELEGRAM_ID
   ```

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** –°–º. `TESTING_SUMMARY.md` –∏–ª–∏ `TESTING_GUIDE.md`

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã

```bash
pytest tests/
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- **Python 3.12+**
- **PostgreSQL** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Redis** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á Celery
- **Celery** - —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- **SQLAlchemy** - ORM
- **python-telegram-bot** - Telegram –±–æ—Ç API

## –õ–∏—Ü–µ–Ω–∑–∏—è

[–£–∫–∞–∑–∞—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—é]
